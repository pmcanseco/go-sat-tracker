package main

import (
	"context"
	"fmt"
	"os"
	"os/signal"
	"syscall"
	"time"

	tinyTime "github.com/pmcanseco/go-sat-tracker/internal/time"
	"github.com/pmcanseco/go-sat-tracker/internal/tracking"
)

func main() {
	//cfg := config.Get()
	tinyTime.SetTime(time.Now())
	//
	//sat := satellite.NewSatellite(
	//	"1 25544U 98067A   23144.86253841  .00014539  00000-0  26082-3 0  9994",
	//	"2 25544  51.6411  84.1532 0005431  16.7594  53.2286 15.50149056398178",
	//	gosat.GravityWGS84)
	//sat := satellite.NewSatellite(
	//	"1 25544U 98067A   23032.08288244  .00011898  00000-0  21365-3 0  9993",
	//	"2 25544  51.6434 282.6761 0004766 300.0617 145.9076 15.50324176380688",
	//	gosat.GravityWGS84)
	tracker := tracking.NewTrackerWithPlan(
		[]byte(`{"Passes":[{"StartTime":"2023-07-06T00:27:20.2515306-06:00","StartLookAngles":{"az":237.0570003726518,"el":10.306801230976792},"MidTime":"2023-07-06T00:30:32.2515306-06:00","MidLookAngles":{"az":319.6983562290914,"el":74.78322784216391},"EndTime":"2023-07-06T00:33:50.2515306-06:00","EndLookAngles":{"az":49.55087570736627,"el":9.733542459056535},"FullPath":[{"Time":"2023-07-06T00:27:20.2515306-06:00","az":237.0570003726518,"el":10.306801230976792},{"Time":"2023-07-06T00:27:23.2515306-06:00","az":237.1349613569826,"el":10.642675321057737},{"Time":"2023-07-06T00:27:26.2515306-06:00","az":237.21514827519854,"el":10.985594891677703},{"Time":"2023-07-06T00:27:29.2515306-06:00","az":237.29766956671796,"el":11.335866291424372},{"Time":"2023-07-06T00:27:32.2515306-06:00","az":237.38264084381998,"el":11.693813034436305},{"Time":"2023-07-06T00:27:35.2515306-06:00","az":237.47018191824046,"el":12.059762077016963},{"Time":"2023-07-06T00:27:38.2515306-06:00","az":237.56042551050726,"el":12.434078897877104},{"Time":"2023-07-06T00:27:41.2515306-06:00","az":237.65350856165182,"el":12.817129512592011},{"Time":"2023-07-06T00:27:44.2515306-06:00","az":237.74958140137431,"el":13.209316732292653},{"Time":"2023-07-06T00:27:47.2515306-06:00","az":237.84880516834923,"el":13.611067161492885},{"Time":"2023-07-06T00:27:50.2515306-06:00","az":237.95134860238835,"el":14.022816104372083},{"Time":"2023-07-06T00:27:53.2515306-06:00","az":238.05739854306037,"el":14.445047364605625},{"Time":"2023-07-06T00:27:56.2515306-06:00","az":238.16715010821397,"el":14.87825092089498},{"Time":"2023-07-06T00:27:59.2515306-06:00","az":238.2808178608958,"el":15.322964240945948},{"Time":"2023-07-06T00:28:02.2515306-06:00","az":238.39863326266484,"el":15.779758170774954},{"Time":"2023-07-06T00:28:05.2515306-06:00","az":238.5208413568073,"el":16.24922020993516},{"Time":"2023-07-06T00:28:08.2515306-06:00","az":238.64771383872912,"el":16.732000349365784},{"Time":"2023-07-06T00:28:11.2515306-06:00","az":238.77953801925656,"el":17.228763380451333},{"Time":"2023-07-06T00:28:14.2515306-06:00","az":238.91663093524184,"el":17.740236691519442},{"Time":"2023-07-06T00:28:17.2515306-06:00","az":239.0593372232759,"el":18.267194865614282},{"Time":"2023-07-06T00:28:20.2515306-06:00","az":239.2080260698752,"el":18.81044094838089},{"Time":"2023-07-06T00:28:23.2515306-06:00","az":239.36310822671203,"el":19.370860060655144},{"Time":"2023-07-06T00:28:26.2515306-06:00","az":239.52502391760436,"el":19.949364894379197},{"Time":"2023-07-06T00:28:29.2515306-06:00","az":239.69426161551715,"el":20.546951832716694},{"Time":"2023-07-06T00:28:32.2515306-06:00","az":239.87135731570888,"el":21.16468388807549},{"Time":"2023-07-06T00:28:35.2515306-06:00","az":240.05689278516186,"el":21.803669275096233},{"Time":"2023-07-06T00:28:38.2515306-06:00","az":240.2515191703543,"el":22.465124935186292},{"Time":"2023-07-06T00:28:41.2515306-06:00","az":240.45594478214554,"el":23.15031293413722},{"Time":"2023-07-06T00:28:44.2515306-06:00","az":240.6709620208342,"el":23.860607017925535},{"Time":"2023-07-06T00:28:47.2515306-06:00","az":240.8974506020256,"el":24.597472858490544},{"Time":"2023-07-06T00:28:50.2515306-06:00","az":241.13637995951711,"el":25.362442291071904},{"Time":"2023-07-06T00:28:53.2515306-06:00","az":241.38884517409642,"el":26.15718879930341},{"Time":"2023-07-06T00:28:56.2515306-06:00","az":241.65605802570545,"el":26.983450517719184},{"Time":"2023-07-06T00:28:59.2515306-06:00","az":241.93939003707376,"el":27.843108660872556},{"Time":"2023-07-06T00:29:02.2515306-06:00","az":242.2403867844516,"el":28.738161770359827},{"Time":"2023-07-06T00:29:05.2515306-06:00","az":242.56078282414433,"el":29.670690959573648},{"Time":"2023-07-06T00:29:08.2515306-06:00","az":242.9025641813282,"el":30.642947129321797},{"Time":"2023-07-06T00:29:11.2515306-06:00","az":243.26797428673677,"el":31.657250806458126},{"Time":"2023-07-06T00:29:14.2515306-06:00","az":243.65959432323146,"el":32.71607952887556},{"Time":"2023-07-06T00:29:17.2515306-06:00","az":244.0803907283247,"el":33.822025373909085},{"Time":"2023-07-06T00:29:20.2515306-06:00","az":244.53376980696254,"el":34.977737115226745},{"Time":"2023-07-06T00:29:23.2515306-06:00","az":245.023708569247,"el":36.186009020268834},{"Time":"2023-07-06T00:29:26.2515306-06:00","az":245.55481787674324,"el":37.44963211344846},{"Time":"2023-07-06T00:29:29.2515306-06:00","az":246.1325273437769,"el":38.771471150049216},{"Time":"2023-07-06T00:29:32.2515306-06:00","az":246.7632450365748,"el":40.15437182391189},{"Time":"2023-07-06T00:29:35.2515306-06:00","az":247.45455352416752,"el":41.60103736285416},{"Time":"2023-07-06T00:29:38.2515306-06:00","az":248.21555831522133,"el":43.114075209940395},{"Time":"2023-07-06T00:29:41.2515306-06:00","az":249.05718383874304,"el":44.69572971561606},{"Time":"2023-07-06T00:29:44.2515306-06:00","az":249.99273858493927,"el":46.34789893014723},{"Time":"2023-07-06T00:29:47.2515306-06:00","az":251.0384582342908,"el":48.07177631729722},{"Time":"2023-07-06T00:29:50.2515306-06:00","az":252.2144306951293,"el":49.86776048623078},{"Time":"2023-07-06T00:29:53.2515306-06:00","az":253.54568884720342,"el":51.73507986246722},{"Time":"2023-07-06T00:29:56.2515306-06:00","az":255.06365852370755,"el":53.671308581122936},{"Time":"2023-07-06T00:29:59.2515306-06:00","az":256.8083295240039,"el":55.67201798116682},{"Time":"2023-07-06T00:30:02.2515306-06:00","az":258.83084713323365,"el":57.72987843138144},{"Time":"2023-07-06T00:30:05.2515306-06:00","az":261.197369086767,"el":59.83392599442306},{"Time":"2023-07-06T00:30:08.2515306-06:00","az":263.9938803797674,"el":61.96824353433593},{"Time":"2023-07-06T00:30:11.2515306-06:00","az":267.33213671647667,"el":64.1101752869876},{"Time":"2023-07-06T00:30:14.2515306-06:00","az":271.35666528466226,"el":66.22820179395889},{"Time":"2023-07-06T00:30:17.2515306-06:00","az":276.24944301701225,"el":68.27859484702775},{"Time":"2023-07-06T00:30:20.2515306-06:00","az":282.22715608457344,"el":70.20175000619858},{"Time":"2023-07-06T00:30:23.2515306-06:00","az":289.5153505963455,"el":71.91828087417224},{"Time":"2023-07-06T00:30:26.2515306-06:00","az":298.27541525283743,"el":73.32793287136089},{"Time":"2023-07-06T00:30:29.2515306-06:00","az":308.4682151347386,"el":74.31737703930746},{"Time":"2023-07-06T00:30:32.2515306-06:00","az":319.6983562290914,"el":74.78322784216391},{"Time":"2023-07-06T00:30:35.2515306-06:00","az":331.2020052256205,"el":74.66800536913544},{"Time":"2023-07-06T00:30:38.2515306-06:00","az":342.101639159995,"el":73.9862631266086},{"Time":"2023-07-06T00:30:41.2515306-06:00","az":351.7611890149699,"el":72.81756281701858},{"Time":"2023-07-06T00:30:44.2515306-06:00","az":359.93820207449977,"el":71.27288986135665},{"Time":"2023-07-06T00:30:47.2515306-06:00","az":6.691119319753612,"el":69.46228517045357},{"Time":"2023-07-06T00:30:50.2515306-06:00","az":12.219236252140645,"el":67.47811557723034},{"Time":"2023-07-06T00:30:53.2515306-06:00","az":16.75005853937965,"el":65.39173381870982},{"Time":"2023-07-06T00:30:56.2515306-06:00","az":20.488019385886087,"el":63.25618300318715},{"Time":"2023-07-06T00:30:59.2515306-06:00","az":23.600350952217266,"el":61.11000900697354},{"Time":"2023-07-06T00:31:02.2515306-06:00","az":26.217933634915315,"el":58.98109114605601},{"Time":"2023-07-06T00:31:05.2515306-06:00","az":28.4417749326303,"el":56.88923266997411},{"Time":"2023-07-06T00:31:08.2515306-06:00","az":30.349471644798445,"el":54.84830532272735},{"Time":"2023-07-06T00:31:11.2515306-06:00","az":32.000780282601674,"el":52.867828696271616},{"Time":"2023-07-06T00:31:14.2515306-06:00","az":33.44217746684143,"el":50.953882327533},{"Time":"2023-07-06T00:31:17.2515306-06:00","az":34.70998488354604,"el":49.110138832381104},{"Time":"2023-07-06T00:31:20.2515306-06:00","az":35.832964400010134,"el":47.33830295762615},{"Time":"2023-07-06T00:31:23.2515306-06:00","az":36.834064559336056,"el":45.638668160599316},{"Time":"2023-07-06T00:31:26.2515306-06:00","az":37.7317332230462,"el":44.01054757996347},{"Time":"2023-07-06T00:31:29.2515306-06:00","az":38.54100998649702,"el":42.45240144437759},{"Time":"2023-07-06T00:31:32.2515306-06:00","az":39.27418134879216,"el":40.96223287431353},{"Time":"2023-07-06T00:31:35.2515306-06:00","az":39.9414295169186,"el":39.53761062761821},{"Time":"2023-07-06T00:31:38.2515306-06:00","az":40.55123099844805,"el":38.17586801080364},{"Time":"2023-07-06T00:31:41.2515306-06:00","az":41.11067134250114,"el":36.87425511118783},{"Time":"2023-07-06T00:31:44.2515306-06:00","az":41.62576122233195,"el":35.62988995665844},{"Time":"2023-07-06T00:31:47.2515306-06:00","az":42.10158017345612,"el":34.439956079158826},{"Time":"2023-07-06T00:31:50.2515306-06:00","az":42.542487716718064,"el":33.301626349085375},{"Time":"2023-07-06T00:31:53.2515306-06:00","az":42.95222884623406,"el":32.212146870566066},{"Time":"2023-07-06T00:31:56.2515306-06:00","az":43.334022549674216,"el":31.168899169141007},{"Time":"2023-07-06T00:31:59.2515306-06:00","az":43.69068240554876,"el":30.16931377304146},{"Time":"2023-07-06T00:32:02.2515306-06:00","az":44.02464295539656,"el":29.21099112838142},{"Time":"2023-07-06T00:32:05.2515306-06:00","az":44.33805333487755,"el":28.291598858932424},{"Time":"2023-07-06T00:32:08.2515306-06:00","az":44.63278673405975,"el":27.408976248396883},{"Time":"2023-07-06T00:32:11.2515306-06:00","az":44.910508108209164,"el":26.561045814254133},{"Time":"2023-07-06T00:32:14.2515306-06:00","az":45.17269180388563,"el":25.74584991395268},{"Time":"2023-07-06T00:32:17.2515306-06:00","az":45.42063818261671,"el":24.961577780791185},{"Time":"2023-07-06T00:32:20.2515306-06:00","az":45.65551972338715,"el":24.206485556335473},{"Time":"2023-07-06T00:32:23.2515306-06:00","az":45.878372888815015,"el":23.478975558070534},{"Time":"2023-07-06T00:32:26.2515306-06:00","az":46.09013634101003,"el":22.777519130125526},{"Time":"2023-07-06T00:32:29.2515306-06:00","az":46.291654204728026,"el":22.10068319740402},{"Time":"2023-07-06T00:32:32.2515306-06:00","az":46.48368007153227,"el":21.44715052213237},{"Time":"2023-07-06T00:32:35.2515306-06:00","az":46.666905418139756,"el":20.8156516303067},{"Time":"2023-07-06T00:32:38.2515306-06:00","az":46.84194741629017,"el":20.20502984717105},{"Time":"2023-07-06T00:32:41.2515306-06:00","az":47.009373740182085,"el":19.614176303956516},{"Time":"2023-07-06T00:32:44.2515306-06:00","az":47.169701070603956,"el":19.04205179927505},{"Time":"2023-07-06T00:32:47.2515306-06:00","az":47.32339461689504,"el":18.487704124227736},{"Time":"2023-07-06T00:32:50.2515306-06:00","az":47.47088775602818,"el":17.950210696281555},{"Time":"2023-07-06T00:32:53.2515306-06:00","az":47.61256972508075,"el":17.428734091560504},{"Time":"2023-07-06T00:32:56.2515306-06:00","az":47.74880337180115,"el":16.922467263371736},{"Time":"2023-07-06T00:32:59.2515306-06:00","az":47.879922141615,"el":16.43065257352577},{"Time":"2023-07-06T00:33:02.2515306-06:00","az":48.0062279993038,"el":15.952597380013795},{"Time":"2023-07-06T00:33:05.2515306-06:00","az":48.12800611366001,"el":15.487625266959054},{"Time":"2023-07-06T00:33:08.2515306-06:00","az":48.24551353731794,"el":15.035124526646317},{"Time":"2023-07-06T00:33:11.2515306-06:00","az":48.3589927906935,"el":14.594501415584222},{"Time":"2023-07-06T00:33:14.2515306-06:00","az":48.46866849878732,"el":14.165197113978547},{"Time":"2023-07-06T00:33:17.2515306-06:00","az":48.5747448104145,"el":13.74670198995417},{"Time":"2023-07-06T00:33:20.2515306-06:00","az":48.67741699468974,"el":13.338513531142898},{"Time":"2023-07-06T00:33:23.2515306-06:00","az":48.77686132132118,"el":12.940179299669213},{"Time":"2023-07-06T00:33:26.2515306-06:00","az":48.8732459575829,"el":12.551256430027394},{"Time":"2023-07-06T00:33:29.2515306-06:00","az":48.96672768103039,"el":12.171326917033156},{"Time":"2023-07-06T00:33:32.2515306-06:00","az":49.05744923004257,"el":11.800010751927562},{"Time":"2023-07-06T00:33:35.2515306-06:00","az":49.14554882405442,"el":11.436929075220448},{"Time":"2023-07-06T00:33:38.2515306-06:00","az":49.23115117820293,"el":11.081742674281871},{"Time":"2023-07-06T00:33:41.2515306-06:00","az":49.31437654781235,"el":10.734116353467474},{"Time":"2023-07-06T00:33:44.2515306-06:00","az":49.39533766200816,"el":10.393732821339007},{"Time":"2023-07-06T00:33:47.2515306-06:00","az":49.474137174819816,"el":10.060304834651864},{"Time":"2023-07-06T00:33:50.2515306-06:00","az":49.55087570736627,"el":9.733542459056535}],"FullPathDelta":3000000000}]}`))

	sigs := make(chan os.Signal, 1)
	signal.Notify(sigs, syscall.SIGINT, syscall.SIGTERM)
	ctx, cancel := context.WithCancel(context.Background())

	go tracker.Track(context.Background())

	for {
		select {
		case <-sigs:
			fmt.Println("Captured OS signal...")
			cancel()
		case <-ctx.Done():
			fmt.Println("Bye!")
			cancel()
			os.Exit(0)
		}
	}
}
