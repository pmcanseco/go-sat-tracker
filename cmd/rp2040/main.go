package main

import (
	"context"
	"machine"
	"time"

	"github.com/pmcanseco/go-sat-tracker/internal/motors"

	tinygoGPS "tinygo.org/x/drivers/gps"
	"tinygo.org/x/drivers/ssd1306"

	"github.com/pmcanseco/go-sat-tracker/internal/display"
	gpsDevice "github.com/pmcanseco/go-sat-tracker/internal/gps"
	"github.com/pmcanseco/go-sat-tracker/internal/steppermotor"
	tinyTime "github.com/pmcanseco/go-sat-tracker/internal/time"
	"github.com/pmcanseco/go-sat-tracker/internal/tracking"
)

//var (
//	npRed   = []color.RGBA{{255, 0, 0, 127}}
//	npGreen = []color.RGBA{{0, 255, 0, 127}}
//	npBlue  = []color.RGBA{{0, 0, 255, 127}}
//)

func main() {
	//rgb := machine.GPIO16
	//rgb.Configure(machine.PinConfig{Mode: machine.PinOutput})
	//neopixel := ws2812.New(machine.GPIO16)
	//_ = neopixel.WriteColors([]color.RGBA{{0, 0, 0, 255}})

	led := machine.LED
	led.Configure(machine.PinConfig{Mode: machine.PinOutput})
	led.High()
	time.Sleep(500 * time.Millisecond)
	led.Low()
	time.Sleep(500 * time.Millisecond)
	led.High()
	time.Sleep(500 * time.Millisecond)
	led.Low()
	time.Sleep(500 * time.Millisecond)
	led.High()
	time.Sleep(500 * time.Millisecond)

	println("BOOTIN")
	for i := 0; i < 5; i++ {
		print(".")
		time.Sleep(3 * time.Second)
	}

	println("\n\n\nhello world!!!")

	//defer func() {
	//	if r := recover(); r != nil {
	//		println("panicked!")
	//	}
	//}()

	time.Sleep(1 * time.Second)

	//sat := satellite.NewSatellite(
	//	"1 25544U 98067A   23071.22950734  .00021411  00000-0  39277-3 0  9995",
	//	"2 25544  51.6409  88.8414 0005771  75.2083  23.5161 15.49204123386753",
	//	gosat.GravityWGS84)
	//println("MADE SATELLITE!")

	//i2c := machine.I2C1
	//err := i2c.Configure(machine.I2CConfig{
	//	Frequency: 400 * machine.KHz,
	//	SDA:       machine.I2C1_SDA_PIN,
	//	SCL:       machine.I2C1_SCL_PIN,
	//})
	//if err != nil {
	//	_ = neopixel.WriteColors(npRed)
	//}

	//oled := ssd1306.NewI2C(i2c)
	//oled.Configure(ssd1306.Config{
	//	Address: 0x3C,
	//	Width:   128,
	//	Height:  32,
	//})
	//oled.ClearDisplay()

	//d := getDevice(oled)
	//wipeAnimation := display.NewWipeAnimation(d)
	//wipeAnimation.Run()

	//screen := display.NewFontDisplay(d, 128, 32, display.Consolas7pt)

	//screen.Print("IDLE")
	//time.Sleep(1 * time.Second)
	//screen.Print("WAITPASS")
	//time.Sleep(1 * time.Second)
	//screen.Print("TRACK AZ:150 EL:30")
	//time.Sleep(1 * time.Second)
	//screen.Print("TRACKING COMPLETE")
	//time.Sleep(1 * time.Second)

	_ = machine.UART1.Configure(machine.UARTConfig{
		BaudRate: 9600,
		RX:       machine.GPIO9, // WIRING - WHITE GPS WIRE GOES HERE
	})

	ublox := tinygoGPS.NewUART(machine.UART1)
	gps := gpsDevice.New(func() (string, error) {
		s, err := ublox.NextSentence()
		//println(s)
		return s, err
	})

	println("GETTING FIX")

	//gps.SetDebug(screen.Print)
	gps.GetFix()
	println("GOT FIX!")
	gps.SetDebug(nil)
	now, _, lat, lon, alt := gps.GetCoordinates()
	println("GOT COORDS! Lat: ", lat, "\tLon: ", lon, "\t Alt: ", alt)
	for alt == 0 && now.Year() != 1 {
		now, _, lat, lon, alt = gps.GetCoordinates()
		println("GOT COORDS! Lat: ", lat, "\tLon: ", lon, "\t Alt: ", alt)
		time.Sleep(300 * time.Millisecond)
	}
	now = gps.Time()
	gps.Quit()
	time.Sleep(2 * time.Second)
	tinyTime.SetTime(now)
	println("SET TIME! ", tinyTime.GetTime().Format(time.RFC822))
	elMotor := motors.New(getElevationMotor())
	elMotor = elMotor
	println("MADE ELEV MOTOR!")

	//tracker := tracking.NewTracker(
	//	sat,
	//	satellite.Coordinates{
	//		LatitudeDegrees:  float64(lat),
	//		LongitudeDegrees: float64(lon),
	//		AltitudeKM:       float64(alt / 1000),
	//	})
	tracker := tracking.NewTrackerWithPlan(
		[]byte(`{"Passes":[{"FullPath":[{"Time":"2023-06-18T07:02:24.0038985-06:00","az":218.36517940851726,"el":10.188307591339107},{"Time":"2023-06-18T07:02:26.0038985-06:00","az":218.2631395938013,"el":10.407102546817624},{"Time":"2023-06-18T07:02:28.0038985-06:00","az":218.15893824343752,"el":10.628796921699784},{"Time":"2023-06-18T07:02:30.0038985-06:00","az":218.0525062111865,"el":10.853472558539204},{"Time":"2023-06-18T07:02:32.0038985-06:00","az":217.94377804227128,"el":11.081200300085762},{"Time":"2023-06-18T07:02:34.0038985-06:00","az":217.8326789883245,"el":11.312067203772372},{"Time":"2023-06-18T07:02:36.0038985-06:00","az":217.71913337524313,"el":11.54615862787107},{"Time":"2023-06-18T07:02:38.0038985-06:00","az":217.603059964971,"el":11.783567637567641},{"Time":"2023-06-18T07:02:40.0038985-06:00","az":217.4843811768865,"el":12.024375946583465},{"Time":"2023-06-18T07:02:42.0038985-06:00","az":217.36300890098104,"el":12.268682684359376},{"Time":"2023-06-18T07:02:44.0038985-06:00","az":217.23885359406341,"el":12.516585481203446},{"Time":"2023-06-18T07:02:46.0038985-06:00","az":217.11181918219245,"el":12.768190433603616},{"Time":"2023-06-18T07:02:48.0038985-06:00","az":216.981813123686,"el":13.023591913194043},{"Time":"2023-06-18T07:02:50.0038985-06:00","az":216.8487308487057,"el":13.282903064633665},{"Time":"2023-06-18T07:02:52.0038985-06:00","az":216.71246290135883,"el":13.546241112996775},{"Time":"2023-06-18T07:02:54.0038985-06:00","az":216.57290317972624,"el":13.813711259639723},{"Time":"2023-06-18T07:02:56.0038985-06:00","az":216.4299322122607,"el":14.085438609576645},{"Time":"2023-06-18T07:02:58.0038985-06:00","az":216.28342775722825,"el":14.361547216648741},{"Time":"2023-06-18T07:03:00.0038985-06:00","az":216.13325871600912,"el":14.642171187007795},{"Time":"2023-06-18T07:03:02.0038985-06:00","az":215.97929694819845,"el":14.927432168377381},{"Time":"2023-06-18T07:03:04.0038985-06:00","az":215.8213987852725,"el":15.217473380777147},{"Time":"2023-06-18T07:03:06.0038985-06:00","az":215.65941664609053,"el":15.512437297880117},{"Time":"2023-06-18T07:03:08.0038985-06:00","az":215.49319224668554,"el":15.81247750568616},{"Time":"2023-06-18T07:03:10.0038985-06:00","az":215.32256961094888,"el":16.117734633196527},{"Time":"2023-06-18T07:03:12.0038985-06:00","az":215.14737453053027,"el":16.428372739633808},{"Time":"2023-06-18T07:03:14.0038985-06:00","az":214.96742733374938,"el":16.74455545695669},{"Time":"2023-06-18T07:03:16.0038985-06:00","az":214.78253525865478,"el":17.066458689432874},{"Time":"2023-06-18T07:03:18.0038985-06:00","az":214.5925068313641,"el":17.394244779173412},{"Time":"2023-06-18T07:03:20.0038985-06:00","az":214.39712891315781,"el":17.728101535078622},{"Time":"2023-06-18T07:03:22.0038985-06:00","az":214.19617668176355,"el":18.068223535625556},{"Time":"2023-06-18T07:03:24.0038985-06:00","az":213.9894254975461,"el":18.414791229472165},{"Time":"2023-06-18T07:03:26.0038985-06:00","az":213.7766258522109,"el":18.768012152812585},{"Time":"2023-06-18T07:03:28.0038985-06:00","az":213.5575185538625,"el":19.128093856027373},{"Time":"2023-06-18T07:03:30.0038985-06:00","az":213.33182519688722,"el":19.49525829544384},{"Time":"2023-06-18T07:03:32.0038985-06:00","az":213.0992654420405,"el":19.869712290341706},{"Time":"2023-06-18T07:03:34.0038985-06:00","az":212.85952869077875,"el":20.25169195901615},{"Time":"2023-06-18T07:03:36.0038985-06:00","az":212.61229092343044,"el":20.641433429681022},{"Time":"2023-06-18T07:03:38.0038985-06:00","az":212.35720373222313,"el":21.039188321661985},{"Time":"2023-06-18T07:03:40.0038985-06:00","az":212.09391361490336,"el":21.445191634487777},{"Time":"2023-06-18T07:03:42.0038985-06:00","az":211.82202969203792,"el":21.859709768018497},{"Time":"2023-06-18T07:03:44.0038985-06:00","az":211.54113668927525,"el":22.283017267297836},{"Time":"2023-06-18T07:03:46.0038985-06:00","az":211.25081089415505,"el":22.715370433642896},{"Time":"2023-06-18T07:03:48.0038985-06:00","az":210.95058433922807,"el":23.157058278139043},{"Time":"2023-06-18T07:03:50.0038985-06:00","az":210.63996511854714,"el":23.608368443467604},{"Time":"2023-06-18T07:03:52.0038985-06:00","az":210.3184229686238,"el":24.069604729481387},{"Time":"2023-06-18T07:03:54.0038985-06:00","az":209.9854128782114,"el":24.541049405962006},{"Time":"2023-06-18T07:03:56.0038985-06:00","az":209.64033359446853,"el":25.023018387842125},{"Time":"2023-06-18T07:03:58.0038985-06:00","az":209.2825503201949,"el":25.51582371426444},{"Time":"2023-06-18T07:04:00.0038985-06:00","az":208.91137754275593,"el":26.019792215881235},{"Time":"2023-06-18T07:04:02.0038985-06:00","az":208.52610566766108,"el":26.535223805440666},{"Time":"2023-06-18T07:04:04.0038985-06:00","az":208.12595242405777,"el":27.06245116354496},{"Time":"2023-06-18T07:04:06.0038985-06:00","az":207.71008828145642,"el":27.601798058387143},{"Time":"2023-06-18T07:04:08.0038985-06:00","az":207.2776157034691,"el":28.15359897599786},{"Time":"2023-06-18T07:04:10.0038985-06:00","az":206.8275993191938,"el":28.71815254845114},{"Time":"2023-06-18T07:04:12.0038985-06:00","az":206.35900834558797,"el":29.295785880538656},{"Time":"2023-06-18T07:04:14.0038985-06:00","az":205.870735106244,"el":29.88681977711523},{"Time":"2023-06-18T07:04:16.0038985-06:00","az":205.36161975506417,"el":30.491528789658425},{"Time":"2023-06-18T07:04:18.0038985-06:00","az":204.83038438158752,"el":31.11020893639904},{"Time":"2023-06-18T07:04:20.0038985-06:00","az":204.2756642687032,"el":31.74312624088498},{"Time":"2023-06-18T07:04:22.0038985-06:00","az":203.6959780885248,"el":32.39053682822953},{"Time":"2023-06-18T07:04:24.0038985-06:00","az":203.0897660911696,"el":33.05262898234381},{"Time":"2023-06-18T07:04:26.0038985-06:00","az":202.45531051389196,"el":33.72959490271923},{"Time":"2023-06-18T07:04:28.0038985-06:00","az":201.7907712726127,"el":34.42157161224812},{"Time":"2023-06-18T07:04:30.0038985-06:00","az":201.09414903924622,"el":35.128659892822704},{"Time":"2023-06-18T07:04:32.0038985-06:00","az":200.3633300237125,"el":35.850857632238196},{"Time":"2023-06-18T07:04:34.0038985-06:00","az":199.59598935009615,"el":36.58813446166082},{"Time":"2023-06-18T07:04:36.0038985-06:00","az":198.7896165594759,"el":37.34037836581848},{"Time":"2023-06-18T07:04:38.0038985-06:00","az":197.94155387281324,"el":38.107335344277395},{"Time":"2023-06-18T07:04:40.0038985-06:00","az":197.04888495721048,"el":38.88868501551078},{"Time":"2023-06-18T07:04:42.0038985-06:00","az":196.10848500627557,"el":39.683963458043706},{"Time":"2023-06-18T07:04:44.0038985-06:00","az":195.11697093777636,"el":40.49257583647362},{"Time":"2023-06-18T07:04:46.0038985-06:00","az":194.070769746626,"el":41.31371041682828},{"Time":"2023-06-18T07:04:48.0038985-06:00","az":192.96598836452156,"el":42.14641361636387},{"Time":"2023-06-18T07:04:50.0038985-06:00","az":191.79848469905568,"el":42.98950072292548},{"Time":"2023-06-18T07:04:52.0038985-06:00","az":190.5638193882046,"el":43.84156299255238},{"Time":"2023-06-18T07:04:54.0038985-06:00","az":189.25735936595302,"el":44.700871068652454},{"Time":"2023-06-18T07:04:56.0038985-06:00","az":187.87414034554655,"el":45.56544883090717},{"Time":"2023-06-18T07:04:58.0038985-06:00","az":186.40895709023226,"el":46.43299273100993},{"Time":"2023-06-18T07:05:00.0038985-06:00","az":184.85649636562044,"el":47.30078937344389},{"Time":"2023-06-18T07:05:02.0038985-06:00","az":183.21121687281556,"el":48.16579191086195},{"Time":"2023-06-18T07:05:04.0038985-06:00","az":181.46754584522498,"el":49.024524485672885},{"Time":"2023-06-18T07:05:06.0038985-06:00","az":179.6199218234356,"el":49.87309536082272},{"Time":"2023-06-18T07:05:08.0038985-06:00","az":177.66308977441187,"el":50.707114454837665},{"Time":"2023-06-18T07:05:10.0038985-06:00","az":175.5920625570108,"el":51.52179127087107},{"Time":"2023-06-18T07:05:12.0038985-06:00","az":173.40249567321945,"el":52.311874825203915},{"Time":"2023-06-18T07:05:14.0038985-06:00","az":171.09087742684213,"el":53.07171123014471},{"Time":"2023-06-18T07:05:16.0038985-06:00","az":168.6550349078058,"el":53.7952295871545},{"Time":"2023-06-18T07:05:18.0038985-06:00","az":166.09420811011262,"el":54.476105261859146},{"Time":"2023-06-18T07:05:20.0038985-06:00","az":163.40960638140464,"el":55.10779761650027},{"Time":"2023-06-18T07:05:22.0038985-06:00","az":160.60467371793584,"el":55.68370641977355},{"Time":"2023-06-18T07:05:24.0038985-06:00","az":157.68564607431318,"el":56.19728640785463},{"Time":"2023-06-18T07:05:26.0038985-06:00","az":154.66146056411654,"el":56.64230348093872},{"Time":"2023-06-18T07:05:28.0038985-06:00","az":151.54403596375144,"el":57.01299987485346},{"Time":"2023-06-18T07:05:30.0038985-06:00","az":148.34842061125477,"el":57.30429264329047},{"Time":"2023-06-18T07:05:32.0038985-06:00","az":145.09216447161566,"el":57.5120270533671},{"Time":"2023-06-18T07:05:34.0038985-06:00","az":141.795105584462,"el":57.633130492525495},{"Time":"2023-06-18T07:05:36.0038985-06:00","az":138.47858488340387,"el":57.66576553474229},{"Time":"2023-06-18T07:05:38.0038985-06:00","az":135.1649106373511,"el":57.60941925270492},{"Time":"2023-06-18T07:05:40.0038985-06:00","az":131.87608029251356,"el":57.464932739015545},{"Time":"2023-06-18T07:05:42.0038985-06:00","az":128.63318109270713,"el":57.23445486090719},{"Time":"2023-06-18T07:05:44.0038985-06:00","az":125.45548794835949,"el":56.92133210021254},{"Time":"2023-06-18T07:05:46.0038985-06:00","az":122.36010617560203,"el":56.52997910011358},{"Time":"2023-06-18T07:05:48.0038985-06:00","az":119.36117680197347,"el":56.06564818269167},{"Time":"2023-06-18T07:05:50.0038985-06:00","az":116.46987787373247,"el":55.53423020738528},{"Time":"2023-06-18T07:05:52.0038985-06:00","az":113.69458657536892,"el":54.942079479608665},{"Time":"2023-06-18T07:05:54.0038985-06:00","az":111.04068665878809,"el":54.295747257616824},{"Time":"2023-06-18T07:05:56.0038985-06:00","az":108.51107589732703,"el":53.60184284939091},{"Time":"2023-06-18T07:05:58.0038985-06:00","az":106.10640222038529,"el":52.86685575214418},{"Time":"2023-06-18T07:06:00.0038985-06:00","az":103.8256268609025,"el":52.09709322495006},{"Time":"2023-06-18T07:06:02.0038985-06:00","az":101.66610410667802,"el":51.29849884493984},{"Time":"2023-06-18T07:06:04.0038985-06:00","az":99.62412263619072,"el":50.47664593987009},{"Time":"2023-06-18T07:06:06.0038985-06:00","az":97.69512535552637,"el":49.636665111428144},{"Time":"2023-06-18T07:06:08.0038985-06:00","az":95.87412496845823,"el":48.78329115981937},{"Time":"2023-06-18T07:06:10.0038985-06:00","az":94.15568837556178,"el":47.92075650720821},{"Time":"2023-06-18T07:06:12.0038985-06:00","az":92.53426797073449,"el":47.052865757220786},{"Time":"2023-06-18T07:06:14.0038985-06:00","az":91.00426703672511,"el":46.18297768928846},{"Time":"2023-06-18T07:06:16.0038985-06:00","az":89.56026287242605,"el":45.31409778324481},{"Time":"2023-06-18T07:06:18.0038985-06:00","az":88.196896340977,"el":44.44879964783889},{"Time":"2023-06-18T07:06:20.0038985-06:00","az":86.90902295557602,"el":43.58930661073019},{"Time":"2023-06-18T07:06:22.0038985-06:00","az":85.69181680629852,"el":42.73757296543211},{"Time":"2023-06-18T07:06:24.0038985-06:00","az":84.54063484880197,"el":41.89520977778306},{"Time":"2023-06-18T07:06:26.0038985-06:00","az":83.45113094107487,"el":41.06358300190558},{"Time":"2023-06-18T07:06:28.0038985-06:00","az":82.41921014366251,"el":40.24380724037534},{"Time":"2023-06-18T07:06:30.0038985-06:00","az":81.44110606630953,"el":39.436837317627806},{"Time":"2023-06-18T07:06:32.0038985-06:00","az":80.51324794816126,"el":38.64339333581023},{"Time":"2023-06-18T07:06:34.0038985-06:00","az":79.63233362753988,"el":37.86404902245494},{"Time":"2023-06-18T07:06:36.0038985-06:00","az":78.79527902947746,"el":37.09922008125851},{"Time":"2023-06-18T07:06:38.0038985-06:00","az":77.99927096777857,"el":36.34924376259629},{"Time":"2023-06-18T07:06:40.0038985-06:00","az":77.24165219913715,"el":35.614303058850744},{"Time":"2023-06-18T07:06:42.0038985-06:00","az":76.51996147511986,"el":34.894489033323005},{"Time":"2023-06-18T07:06:44.0038985-06:00","az":75.83196000837856,"el":34.18985612473027},{"Time":"2023-06-18T07:06:46.0038985-06:00","az":75.17553135189534,"el":33.500347020555736},{"Time":"2023-06-18T07:06:48.0038985-06:00","az":74.54872769851804,"el":32.825861290696125},{"Time":"2023-06-18T07:06:50.0038985-06:00","az":73.94973150256038,"el":32.166236816477664},{"Time":"2023-06-18T07:06:52.0038985-06:00","az":73.37689213412354,"el":31.521310640965748},{"Time":"2023-06-18T07:06:54.0038985-06:00","az":72.82864340332581,"el":30.890846435532943},{"Time":"2023-06-18T07:06:56.0038985-06:00","az":72.30354278746528,"el":30.274594053514384},{"Time":"2023-06-18T07:06:58.0038985-06:00","az":71.80024041801987,"el":29.672269516791257},{"Time":"2023-06-18T07:07:00.0038985-06:00","az":71.31751104218267,"el":29.08360787296787},{"Time":"2023-06-18T07:07:02.0038985-06:00","az":70.85418586031493,"el":28.508294547557778},{"Time":"2023-06-18T07:07:04.0038985-06:00","az":70.40918658169895,"el":27.946017569152936},{"Time":"2023-06-18T07:07:06.0038985-06:00","az":69.98150035875484,"el":27.396447377773082},{"Time":"2023-06-18T07:07:08.0038985-06:00","az":69.57020807877007,"el":26.859283350179915},{"Time":"2023-06-18T07:07:10.0038985-06:00","az":69.17442747917717,"el":26.334189659124743},{"Time":"2023-06-18T07:07:12.0038985-06:00","az":68.79333551241491,"el":25.82083138053678},{"Time":"2023-06-18T07:07:14.0038985-06:00","az":68.42618549257908,"el":25.318905939308365},{"Time":"2023-06-18T07:07:16.0038985-06:00","az":68.07225704679132,"el":24.828082461969533},{"Time":"2023-06-18T07:07:18.0038985-06:00","az":67.73088332195931,"el":24.348044396131},{"Time":"2023-06-18T07:07:20.0038985-06:00","az":67.40143323803818,"el":23.87847061529555},{"Time":"2023-06-18T07:07:22.0038985-06:00","az":67.08333461556303,"el":23.419073716834255},{"Time":"2023-06-18T07:07:24.0038985-06:00","az":66.77603154839711,"el":22.969543936436697},{"Time":"2023-06-18T07:07:26.0038985-06:00","az":66.47900849434245,"el":22.52958759348571},{"Time":"2023-06-18T07:07:28.0038985-06:00","az":66.19177541879846,"el":22.098909319678235},{"Time":"2023-06-18T07:07:30.0038985-06:00","az":65.91388847747241,"el":21.67724678553356},{"Time":"2023-06-18T07:07:32.0038985-06:00","az":65.64491331028208,"el":21.264318908449482},{"Time":"2023-06-18T07:07:34.0038985-06:00","az":65.38444129563732,"el":20.859852749392452},{"Time":"2023-06-18T07:07:36.0038985-06:00","az":65.13210272490996,"el":20.463607189384852},{"Time":"2023-06-18T07:07:38.0038985-06:00","az":64.88753377522409,"el":20.075324129792964},{"Time":"2023-06-18T07:07:40.0038985-06:00","az":64.65039615512791,"el":19.694761172533738},{"Time":"2023-06-18T07:07:42.0038985-06:00","az":64.42036586201486,"el":19.321675905141333},{"Time":"2023-06-18T07:07:44.0038985-06:00","az":64.1971502916173,"el":18.95585567923002},{"Time":"2023-06-18T07:07:46.0038985-06:00","az":63.980459322695104,"el":18.59707247349713},{"Time":"2023-06-18T07:07:48.0038985-06:00","az":63.7700228896476,"el":18.245112927338454},{"Time":"2023-06-18T07:07:50.0038985-06:00","az":63.56558123854361,"el":17.899763732777352},{"Time":"2023-06-18T07:07:52.0038985-06:00","az":63.36690033770378,"el":17.560839131104867},{"Time":"2023-06-18T07:07:54.0038985-06:00","az":63.17374635845736,"el":17.228139069092805},{"Time":"2023-06-18T07:07:56.0038985-06:00","az":62.98589772467201,"el":16.901470430471623},{"Time":"2023-06-18T07:07:58.0038985-06:00","az":62.803155216700446,"el":16.580666008288052},{"Time":"2023-06-18T07:08:00.0038985-06:00","az":62.62531862523549,"el":16.26554490129232},{"Time":"2023-06-18T07:08:02.0038985-06:00","az":62.45220133713281,"el":15.955938734179263},{"Time":"2023-06-18T07:08:04.0038985-06:00","az":62.28362257034356,"el":15.651678775790463},{"Time":"2023-06-18T07:08:06.0038985-06:00","az":62.11942030078786,"el":15.3526201315503},{"Time":"2023-06-18T07:08:08.0038985-06:00","az":61.95943041201945,"el":15.05860484468746},{"Time":"2023-06-18T07:08:10.0038985-06:00","az":61.80349987361346,"el":14.769486304699337},{"Time":"2023-06-18T07:08:12.0038985-06:00","az":61.65147984371096,"el":14.485117225102366},{"Time":"2023-06-18T07:08:14.0038985-06:00","az":61.50323741029716,"el":14.205372257713014},{"Time":"2023-06-18T07:08:16.0038985-06:00","az":61.3586368624168,"el":13.930113506377289},{"Time":"2023-06-18T07:08:18.0038985-06:00","az":61.21755163866095,"el":13.659213337427422},{"Time":"2023-06-18T07:08:20.0038985-06:00","az":61.079858157932335,"el":13.392543129798678},{"Time":"2023-06-18T07:08:22.0038985-06:00","az":60.945446516323294,"el":13.129994492052642},{"Time":"2023-06-18T07:08:24.0038985-06:00","az":60.8142035774087,"el":12.87144692894003},{"Time":"2023-06-18T07:08:26.0038985-06:00","az":60.68602129358236,"el":12.616784150942388},{"Time":"2023-06-18T07:08:28.0038985-06:00","az":60.56080389680772,"el":12.365908939141312},{"Time":"2023-06-18T07:08:30.0038985-06:00","az":60.43845218850942,"el":12.118712274485171},{"Time":"2023-06-18T07:08:32.0038985-06:00","az":60.31887368606202,"el":11.875093772687078},{"Time":"2023-06-18T07:08:34.0038985-06:00","az":60.201977475693,"el":11.634951598492377},{"Time":"2023-06-18T07:08:36.0038985-06:00","az":60.087683364204665,"el":11.398201595210486},{"Time":"2023-06-18T07:08:38.0038985-06:00","az":59.97590758442913,"el":11.164748184050879},{"Time":"2023-06-18T07:08:40.0038985-06:00","az":59.86657207640843,"el":10.93450364040605},{"Time":"2023-06-18T07:08:42.0038985-06:00","az":59.759599814227194,"el":10.70737857994641},{"Time":"2023-06-18T07:08:44.0038985-06:00","az":59.65492320914109,"el":10.483300064871564},{"Time":"2023-06-18T07:08:46.0038985-06:00","az":59.55247105290718,"el":10.262184090590871},{"Time":"2023-06-18T07:08:48.0038985-06:00","az":59.45217503585618,"el":10.04394946222534},{"Time":"2023-06-18T07:08:50.0038985-06:00","az":59.353975467092894,"el":9.82853060182597}],"FullPathDelta":2000000000}]}`),
	)
	println("MADE TRACKER!")

	tracker.Track(context.Background())
	tracker = tracker

	println("TRACKING ENDED!")
}

func getDevice(device ssd1306.Device) display.Device {
	return display.CustomDevice{
		PixelSetter: device.SetPixel,
		Displayer:   device.Display,
		Clearer:     device.ClearDisplay,
	}
}

func printGPS(printer display.Printer, ts time.Time, numSats int16, lat, lon float32, alt int32) {
	//println(fmt.Sprintf("%s lat %.2f lon %.2f alt %d sats %d",
	//	ts.Format(time.RFC1123), lat, lon, alt, numSats))
	//printer.PrintAt(
	//	0,
	//	fmt.Sprintf("%s SATS:%d",
	//		ts.Format("01/02 15:04:05"),
	//		numSats),
	//	false)
	//printer.PrintAt(
	//	1,
	//	fmt.Sprintf("LON:%.3f",
	//		lon),
	//	false)
	//printer.PrintAt(
	//	2,
	//	fmt.Sprintf("LAT:%.3f @%dM",
	//		lat,
	//		alt),
	//	false)
}

func getElevationMotor() *steppermotor.Device {
	dir := machine.GPIO10
	dir.Configure(machine.PinConfig{Mode: machine.PinOutput})
	dir.High()

	step := machine.GPIO9
	step.Configure(machine.PinConfig{Mode: machine.PinOutput})
	step.Low()

	sleep := machine.GPIO8
	sleep.Configure(machine.PinConfig{Mode: machine.PinOutput})
	sleep.Low()

	sm := steppermotor.New(steppermotor.DeviceConfig{
		StepPin:   step,
		DirPin:    dir,
		SleepPin:  sleep,
		StepCount: 200,
		RPM:       50,
	})
	return sm
}
